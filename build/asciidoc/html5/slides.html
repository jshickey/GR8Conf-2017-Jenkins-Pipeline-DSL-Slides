<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Deep Dive Into Mutual of Omaha’s Custom Jenkins Pipeline DSL</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="reveal.js/css/reveal.css" rel="stylesheet"><link rel="stylesheet" href="reveal.js/css/theme/solarized.css" id="theme"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css"><style>/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}</style><link href="reveal.js/lib/css/zenburn.css" rel="stylesheet"><script>document.write( '<link rel="stylesheet" href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script></head><body><div class="reveal"><div class="slides"><section id="deep-dive-into-mutual-of-omaha-s-custom-jenkins-pipeline-dsl"><h2>Deep Dive Into Mutual of Omaha’s Custom Jenkins Pipeline DSL</h2><div class="paragraph"><p>GR8Conf 2017<br>
July 26 - 28, 2017 · Minneapolis</p></div></section>
<section id="about-me"><h2>About Me</h2><div class="paragraph incremental text-left"><p>Scott Hickey</p></div>
<div class="ulist"><ul><li><p>Principal Enterprise Architect, Mutual of Omaha</p></li><li><p>Mentor for teams adopting the CI Pipeline</p></li><li><p><a href="mailto:scott.hickey@mutualfomaha.com">scott.hickey@mutualfomaha.com</a></p></li><li><p>@jshickey</p></li></ul></div></section>
<section id="agenda"><h2>Agenda</h2><div class="ulist"><ul><li><p>Overview of Project</p></li><li><p>Custom Gradle Distribution</p></li><li><p>Walk-thru of Build Pipeline DSL</p></li><li><p>Successes and Challenges</p></li></ul></div></section>
<section><section id="overview-of-project"><h2>Overview of Project</h2><div class="ulist"><ul><li><p>Sample Pipeline in Jenkins</p></li><li><p>Example of the DSL that creates the pipeline</p></li><li><p>Screen shot Jenkins Job that creates the pipeline</p></li><li><p>Overview of the Environment</p></li><li><p>Jenkins Plugins in Use at Mutual of Omaha</p></li></ul></div></section><section id="enterprise-ci-challenges"><h2>Enterprise CI Challenges</h2><div class="ulist"><ul><li><p>a couple thousand apps</p></li><li><p>lots of cut-and-paste with small changes</p></li><li><p>steep learning curve for each team</p></li><li><p>time consuming, boiler-plate iteration zero work</p></li><li><p>code is managed, jobs are not</p></li></ul></div></section><section id="sample-pipeline-in-jenkins"><div class="paragraph"><div class="title">Sample Pipeline in Jenkins</div><p><span class="image"><img src="./images/PSS-Jenkins-Pipeline-Full-Screen.png" alt="Sample Jenkins Pipeline"></span></p></div></section><section id="gradle-jenkins-plugin"><div class="paragraph"><div class="title">Gradle Jenking Plugin</div><p><span class="image"><img src="./images/Gradle-Jenkins-Plugin-Website.png" alt="Gradle Jenkins Plugin Website"></span></p></div></section><section id="typical-pipeline"><h2>Typical Pipeline</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span>pipelineConfig {
<span class="line-numbers"> 2</span>    asi = <span class="string"><span class="delimiter">'</span><span class="content">PSS</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 3</span>    projectName = <span class="string"><span class="delimiter">'</span><span class="content">PremiumSaverSystem</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 4</span>    buildPipelineRows = <span class="integer">10</span>
<span class="line-numbers"> 5</span>
<span class="line-numbers"> 6</span>    createPipeline {
<span class="line-numbers"> 7</span>        initJob()
<span class="line-numbers"> 8</span>        buildAndUnitTestJob()
<span class="line-numbers"> 9</span>        staticCodeAnalysisJob()
<span class="line-numbers">10</span>        publishSnapshotJob()
<span class="line-numbers">11</span>        promoteToReleaseCandidateJob()
<span class="line-numbers">12</span>        promoteToReleaseJob()
<span class="line-numbers">13</span>    }
<span class="line-numbers">14</span>}</code></pre></div></div></section><section id="customizing-the-pipeline-ex-1"><h2>Customizing The Pipeline ex.1</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span>pipelineConfig {
<span class="line-numbers"> 2</span>    asi = <span class="string"><span class="delimiter">'</span><span class="content">esc</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 3</span>    projectName = <span class="string"><span class="delimiter">'</span><span class="content">MentorPracticeDocs</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 4</span>    buildPipelineRows = <span class="integer">10</span>
<span class="line-numbers"> 5</span>    notifiedUsers = [<span class="string"><span class="delimiter">'</span><span class="content">req84082</span><span class="delimiter">'</span></span>]
<span class="line-numbers"> 6</span>
<span class="line-numbers"> 7</span>    createPipeline {
<span class="line-numbers"> 8</span>        initJob()
<span class="line-numbers"> 9</span>        buildAndUnitTestJob([<span class="key">skipTests</span>: <span class="predefined-constant">true</span>, <span class="key">gradleTasks</span>: <span class="string"><span class="delimiter">'</span><span class="content">assemble</span><span class="delimiter">'</span></span>])
<span class="line-numbers">10</span>        publishSnapshotJob([<span class="key">deployRepository</span>: <span class="string"><span class="delimiter">'</span><span class="content">docs-snapshot-local</span><span class="delimiter">'</span></span>])
<span class="line-numbers">11</span>        promoteToReleaseCandidateJob([<span class="key">deployRepository</span>: <span class="string"><span class="delimiter">'</span><span class="content">docs-release-candidate-local</span><span class="delimiter">'</span></span>])
<span class="line-numbers">12</span>        promoteToReleaseJob([<span class="key">deployRepository</span>: <span class="string"><span class="delimiter">'</span><span class="content">docs-release-local</span><span class="delimiter">'</span></span>])
<span class="line-numbers">13</span>    }
<span class="line-numbers">14</span>}</code></pre></div></div></section><section id="customizing-the-pipeline-ex-2"><h2>Customizing The Pipeline ex.2</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span>pipelineConfig {
<span class="line-numbers"> 2</span>    asi = <span class="string"><span class="delimiter">'</span><span class="content">PSS</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 3</span>    projectName = <span class="string"><span class="delimiter">'</span><span class="content">PremSaverScheduledClient</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 4</span>
<span class="line-numbers"> 5</span>    createPipeline {
<span class="line-numbers"> 6</span>        initJob()
<span class="line-numbers"> 7</span>        genericGradleJob(<span class="string"><span class="delimiter">&quot;</span><span class="content">create-tarball</span><span class="delimiter">&quot;</span></span>,
<span class="line-numbers"> 8</span>            <span class="string"><span class="delimiter">&quot;</span><span class="content">create a tar ball which includes a linux shell script to run the application</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>,
<span class="line-numbers"> 9</span>            [<span class="key">gradleTasks</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">distTar</span><span class="delimiter">&quot;</span></span>])
<span class="line-numbers">10</span>        publishSnapshotJob()
<span class="line-numbers">11</span>        promoteToReleaseCandidateJob()
<span class="line-numbers">12</span>        promoteToReleaseJob()
<span class="line-numbers">13</span>    }
<span class="line-numbers">14</span>}
<span class="line-numbers">15</span>publishing {
<span class="line-numbers">16</span>    publications {
<span class="line-numbers">17</span>        mavenJava(MavenPublication) {
<span class="line-numbers">18</span>            artifact(distTar)
<span class="line-numbers">19</span>        }
<span class="line-numbers">20</span>    }
<span class="line-numbers">21</span>}</code></pre></div></div></section><section id="customizing-the-pipeline-ex-3"><h2>Customizing The Pipeline ex.3</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span>pipelineConfig {
<span class="line-numbers"> 2</span>    asi = <span class="string"><span class="delimiter">'</span><span class="content">PSS</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 3</span>    projectName = <span class="string"><span class="delimiter">'</span><span class="content">PremSaverScheduledClient</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 4</span>
<span class="line-numbers"> 5</span>    createPipeline {
<span class="line-numbers"> 6</span>        initJob() {
<span class="line-numbers"> 7</span>            triggers {
<span class="line-numbers"> 8</span>                cron(<span class="string"><span class="delimiter">'</span><span class="content">30 2 * * *</span><span class="delimiter">'</span></span>)
<span class="line-numbers"> 9</span>            }
<span class="line-numbers">10</span>        }
<span class="line-numbers">11</span>        buildAndUnitTestJob()
<span class="line-numbers">12</span>        staticCodeAnalysisJob()
<span class="line-numbers">13</span>    }
<span class="line-numbers">14</span>}</code></pre></div></div></section><section id="seeding-the-pipeline"><div class="paragraph"><div class="title">Seeding the Pipeline</div><p><span class="image"><img src="./images/Jenkins-Home-Page.png" alt="Seeding the Pipeline"></span></p></div></section><section id="create-pipeline"><div class="paragraph"><div class="title">Create Pipeline</div><p><span class="image"><img src="./images/Create-Pipeline.png" alt="Create Pipeline"></span></p></div></section><section id="our-environment"><h2>Our Environment</h2><div class="ulist"><ul><li><p>Subversion &amp; Bitbucket</p></li><li><p>Jenkins</p></li><li><p>SonarQube</p></li><li><p>Artifactory</p></li><li><p>Fisheye</p></li><li><p>Crucible</p></li><li><p>JIRA</p></li></ul></div></section><section id="integration"><h2>Integration</h2><div class="ulist"><ul><li><p>Subversion &#8594; Jenkins, JIRA, Artifactory</p></li><li><p>Jenkins &#8594; JIRA, Artifactory, SonarQube</p></li><li><p>Artifactory &#8594; Jenkins, Subversion, JIRA</p></li><li><p>JIRA &#8594; Jenkins</p></li><li><p>Crucible &#8594; JIRA</p></li></ul></div></section><section id="subversion-integration-with-jenkins"><div class="paragraph"><div class="title"><em>Subversion Integration With Jenkins</em></div><p><span class="image"><img src="./images/init-job-console-output.png" alt="Subversion Integration With Jenkins"></span></p></div></section><section id="subversion-changes-in-jenkins"><div class="paragraph"><p>Subversion Changes in Jenkins
<span class="image"><img src="./images/subversion-changes-in-jenkins.png" alt="Subversion Changes in Jenkins"></span></p></div></section><section id="subversion-changes-in-fisheye"><div class="paragraph"><div class="title">Subversion Changes in Fisheye</div><p><span class="image"><img src="./images/subversion-changes-in-fisheye.png" alt="Subversion Changes in Fisheye"></span></p></div></section><section id="jenkins-console-for-sonar-job"><div class="paragraph"><div class="title">Jenkins Console for Sonar Job</div><p><span class="image"><img src="./images/jenkins-console-for-sonar-job.png" alt="Jenkins Console for Sonar Job"></span></p></div></section><section id="screenshot-sonar-project-home-page"><div class="paragraph"><div class="title">Sonar Project Home Page</div><p><span class="image"><img src="./images/sonar-pss-project-home-page.png" alt="Sonar Project Home Page"></span></p></div></section><section id="screenshot-sonar-code-coverage"><div class="paragraph"><div class="title">Sonar Code Coverage</div><p><span class="image"><img src="./images/sonar-code-coverage.png" alt="Sonar Code Coverage"></span></p></div></section><section id="screenshot-aritfactory-build-browser"><div class="paragraph"><div class="title">Aritfactory Build Browser</div><p><span class="image"><img src="./images/artifactory-build-browser.png" alt="Aritfactory Build Browser"></span></p></div></section><section id="screenshot-artifactory-published-artifacts"><div class="paragraph"><div class="title">Artifactory Published Artifacts</div><p><span class="image"><img src="./images/artifactory-published-artifacts.png" alt="Artifactory Published Artifacts"></span></p></div></section><section id="screenshot-artifactory-build-environment"><div class="paragraph"><div class="title">Artifactory Build Environment</div><p><span class="image"><img src="./images/artifactory-build-environment.png" alt="artifactory build environment"></span></p></div></section><section id="screenshot-artifactory-rc-jira-issues"><div class="paragraph"><div class="title">Artifactory &#8594; JIRA Issue</div><p><span class="image"><img src="./images/artifactory-rc-jira-issues.png" alt="artifactory-rc-jira-issues"></span></p></div></section><section id="screenshot-jira-issue"><div class="paragraph"><div class="title">JIRA Issue</div><p><span class="image"><img src="./images/jira-issue.png" alt="jira-issue"></span></p></div></section><section id="screenshot-jira-code-review-popup"><div class="paragraph"><div class="title">JIRA Code Review Popup</div><p><span class="image"><img src="./images/jira-code-review-popup.png" alt="jira-code-review-popup"></span></p></div></section><section id="screenshot-crucible-code-review"><div class="paragraph"><div class="title">Crucible Code Review</div><p><span class="image"><img src="./images/crucible-code-review.png" alt="crucible-code-review"></span></p></div></section></section>
<section><section id="mutual-of-omaha-s-custom-gradle-distribution"><h2>Mutual of Omaha&#8217;s Custom Gradle Distribution</h2></section><section id="ci-platform-team-assembling-the-distribution"><h2>CI Platform Team: Assembling the Distribution</h2><div class="ulist"><ul><li><p>Download Distribution from Gradle</p></li><li><p>Unzip &amp; Add Custom Init Scripts</p></li><li><p>Repackage &amp; Store in Artifactory</p></li></ul></div></section><section id="developers-using-the-distribution"><h2>Developers: Using the Distribution</h2><div class="listingblock"><div class="title">gradle-wrapper.properties</div><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers">1</span>distributionUrl=https<span class="error">\</span>:<span class="comment">//artifactory/tools-release-local/path/to/archive/mutual-gradle-2.13-r0.zip</span></code></pre></div></div></section><section id="init-scripts"><h2>Init Scripts</h2><div class="olist arabic"><ol class="arabic"><li><p>Artifactory</p></li><li><p>Check for Updates</p></li><li><p>Setup Dependencies</p></li><li><p>Migration</p></li><li><p>Lint</p></li></ol></div></section><section id="init-script-artifactory-setup"><h2>Init Script &#8594; Artifactory Setup</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span>rootProject {
<span class="line-numbers"> 2</span>    <span class="keyword">if</span> (rootProject.hasProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">ARTIFACTORY_URL</span><span class="delimiter">&quot;</span></span>)) {
<span class="line-numbers"> 3</span>        ext.artifactoryUrl = ARTIFACTORY_URL
<span class="line-numbers"> 4</span>        logger.warn <span class="string"><span class="delimiter">&quot;</span><span class="content">init.d (artifactory): Artifactory URL overridden by project property.</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers"> 5</span>    } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="predefined-type">System</span>.env[<span class="string"><span class="delimiter">&quot;</span><span class="content">ARTIFACTORY_URL</span><span class="delimiter">&quot;</span></span>]) {
<span class="line-numbers"> 6</span>        ext.artifactoryUrl = <span class="predefined-type">System</span>.env[<span class="string"><span class="delimiter">&quot;</span><span class="content">ARTIFACTORY_URL</span><span class="delimiter">&quot;</span></span>]
<span class="line-numbers"> 7</span>        logger.warn <span class="string"><span class="delimiter">&quot;</span><span class="content">init.d (artifactory): Artifactory URL overridden by system environment property.</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers"> 8</span>    } <span class="keyword">else</span> {
<span class="line-numbers"> 9</span>        ext.artifactoryUrl = <span class="string"><span class="delimiter">&quot;</span><span class="content">https://moo.com/artifactory</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers">10</span>    }
<span class="line-numbers">11</span>    logger.quiet <span class="string"><span class="delimiter">&quot;</span><span class="content">init.d (artifactory): Artifactory URL --&gt; </span><span class="inline"><span class="inline-delimiter">$</span>artifactoryUrl</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers">12</span>
<span class="line-numbers">13</span>...</code></pre></div></div></section><section id="artifactory-setup-cont"><h2>Artifactory Setup (cont.)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span>rootProject {
<span class="line-numbers"> 2</span>    ...
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    if (rootProject.hasProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">TOOLS_REPO_URL</span><span class="delimiter">&quot;</span></span>)) {
<span class="line-numbers"> 5</span>        ext.toolsRepoUrl = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>TOOLS_REPO_URL</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers"> 6</span>        logger.warn <span class="string"><span class="delimiter">&quot;</span><span class="content">init.d (artifactory): Tools repo URL overridden by project property (TOOLS_REPO_URL).</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers"> 7</span>    } <span class="keyword">else</span> <span class="keyword">if</span> (rootProject.hasProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">TOOLS_REPO</span><span class="delimiter">&quot;</span></span>)) {
<span class="line-numbers"> 8</span>        ext.toolsRepoUrl = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>artifactoryUrl</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>TOOLS_REPO</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers"> 9</span>        logger.warn <span class="string"><span class="delimiter">&quot;</span><span class="content">init.d (artifactory): Tools repo URL overridden by project property (TOOLS_REPO).</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers">10</span>    } <span class="keyword">else</span> {
<span class="line-numbers">11</span>        ext.toolsRepoUrl = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>artifactoryUrl</span><span class="content">/tools-release-local</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers">12</span>    }
<span class="line-numbers">13</span>
<span class="line-numbers">14</span>    logger.quiet <span class="string"><span class="delimiter">&quot;</span><span class="content">init.d (artifactory): Tools Repo URL  --&gt; </span><span class="inline"><span class="inline-delimiter">$</span>toolsRepoUrl</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers">15</span>}</code></pre></div></div></section><section id="init-script-check-for-update"><h2>Init Script &#8594; Check For Update</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span>rootProject {
<span class="line-numbers"> 2</span>    <span class="keyword">def</span> DISTRIBUTION_NAME = <span class="string"><span class="delimiter">&quot;</span><span class="content">mutual-gradle</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers"> 3</span>    <span class="keyword">def</span> localWrapperNameAndVersion = ...
<span class="line-numbers"> 4</span>
<span class="line-numbers"> 5</span>    if (localWrapperNameAndVersion.startsWith(DISTRIBUTION_NAME)) {
<span class="line-numbers"> 6</span>        <span class="keyword">def</span> localWrapperVersion = localWrapperNameAndVersion.substring(DISTRIBUTION_NAME.length() + <span class="integer">1</span>)
<span class="line-numbers"> 7</span>        <span class="keyword">def</span> allVersions = <span class="keyword">new</span> JsonSlurper().parseText(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>artifactoryUrl</span><span class="content">/api/search/versions?g=com.mutualofomaha&amp;a=</span><span class="inline"><span class="inline-delimiter">$</span>DISTRIBUTION_NAME</span><span class="content">&amp;repos=tools-release-local</span><span class="delimiter">&quot;</span></span>).text).results.version
<span class="line-numbers"> 8</span>        <span class="keyword">def</span> latestWrapperVersion = allVersions[<span class="integer">0</span>]
<span class="line-numbers"> 9</span>
<span class="line-numbers">10</span>        <span class="keyword">if</span> (localWrapperVersion != latestWrapperVersion) {
<span class="line-numbers">11</span>            <span class="keyword">def</span> newerVersions = allVersions[<span class="integer">0</span>..localWrapperVersionIndex - <span class="integer">1</span>]
<span class="line-numbers">12</span>
<span class="line-numbers">13</span>            <span class="comment">// Show an update banner to the user, if they're not using the current version of the wrapper.</span>
<span class="line-numbers">14</span>            logger.warn <span class="string"><span class="delimiter">&quot;</span><span class="content">init.d (checkForUpdates): The following newer Gradle versions are available (you're using </span><span class="inline"><span class="inline-delimiter">$</span>localWrapperVersion</span><span class="content">): </span><span class="inline"><span class="inline-delimiter">${</span>newerVersions.join(<span class="string"><span class="delimiter">'</span><span class="content">, </span><span class="delimiter">'</span></span>)<span class="inline-delimiter">}</span></span><span class="content">.</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers">15</span>            logger.warn <span class="string"><span class="delimiter">&quot;</span><span class="content">init.d (checkForUpdates): Update the distributionUrl property in gradle/wrapper/gradle-wrapper.properties to change the version you're using.</span><span class="delimiter">&quot;</span></span>
<span class="line-numbers">16</span>....</code></pre></div></div></section><section id="init-script-setup-dependencies"><h2>Init Script &#8594; Setup Dependencies</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span><span class="keyword">def</span> LOCAL_GRADLE_PLUGINS_WARNING_MSG = <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content"></span></span>
<span class="line-numbers"> 2</span><span class="string"><span class="content">init.d (setupDependencies): USE_LOCAL_MOO_GRADLE_PLUGINS property found.</span></span>
<span class="line-numbers"> 3</span><span class="string"><span class="content">You will need to include a local Gradle Plugins jar in your buildscript classpath e.g.:&quot;</span></span>
<span class="line-numbers"> 4</span><span class="string"><span class="content">buildscript {</span></span>
<span class="line-numbers"> 5</span><span class="string"><span class="content">    dependencies {</span></span>
<span class="line-numbers"> 6</span><span class="string"><span class="content">        classpath files('../GradlePlugins/build/libs/gradle-plugins-x.x-SNAPSHOT.jar')</span></span>
<span class="line-numbers"> 7</span><span class="string"><span class="content">    }</span></span>
<span class="line-numbers"> 8</span><span class="string"><span class="content">}&quot;</span></span>
<span class="line-numbers"> 9</span><span class="string"><span class="content"></span><span class="delimiter">&quot;&quot;&quot;</span></span>
<span class="line-numbers">10</span>...</code></pre></div></div></section><section id="setup-dependencies-cont"><h2>Setup Dependencies (cont.)</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span>allprojects {
<span class="line-numbers"> 2</span>    configurations.all {
<span class="line-numbers"> 3</span>        resolutionStrategy.cacheDynamicVersionsFor <span class="integer">0</span>, <span class="string"><span class="delimiter">'</span><span class="content">seconds</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 4</span>        resolutionStrategy.cacheChangingModulesFor <span class="integer">0</span>, <span class="string"><span class="delimiter">'</span><span class="content">seconds</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 5</span>    }
<span class="line-numbers"> 6</span>
<span class="line-numbers"> 7</span>    buildscript {
<span class="line-numbers"> 8</span>        repositories {
<span class="line-numbers"> 9</span>            <span class="keyword">if</span> (rootProject.hasProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">USE_RC_PLUGIN</span><span class="delimiter">&quot;</span></span>)) {
<span class="line-numbers">10</span>                logger.warn USE_RC_PLUGIN_WARNING_MSG
<span class="line-numbers">11</span>            }
<span class="line-numbers">12</span>            maven { url <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>toolsRepoUrl</span><span class="delimiter">&quot;</span></span> }
<span class="line-numbers">13</span>            maven { url <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>artifactoryUrl</span><span class="content">/libs-release</span><span class="delimiter">&quot;</span></span> }
<span class="line-numbers">14</span>        }
<span class="line-numbers">15</span>
<span class="line-numbers">16</span>        dependencies {
<span class="line-numbers">17</span>            <span class="keyword">if</span> (rootProject.hasProperty(<span class="string"><span class="delimiter">'</span><span class="content">USE_LOCAL_MOO_GRADLE_PLUGINS</span><span class="delimiter">'</span></span>)) {
<span class="line-numbers">18</span>                logger.warn LOCAL_GRADLE_PLUGINS_WARNING_MSG
<span class="line-numbers">19</span>            } <span class="keyword">else</span> {
<span class="line-numbers">20</span>                classpath <span class="string"><span class="delimiter">'</span><span class="content">com.mutualofomaha:gradle-plugins:3.+</span><span class="delimiter">'</span></span>
<span class="line-numbers">21</span>            }
<span class="line-numbers">22</span>...</code></pre></div></div></section><section id="build-tasks-for-custom-gradle-distro"><h2>Build Tasks for Custom Gradle Distro</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span>task downloadGradleDist(<span class="key">type</span>: UrlDownload) {
<span class="line-numbers"> 2</span>    url = wrapper.distributionUrl
<span class="line-numbers"> 3</span>    destination = file(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>buildDir</span><span class="content">/gradle.zip</span><span class="delimiter">&quot;</span></span>)
<span class="line-numbers"> 4</span>}
<span class="line-numbers"> 5</span>
<span class="line-numbers"> 6</span>task repackageGradle(<span class="key">type</span>: Zip, <span class="key">dependsOn</span>: downloadGradleDist) {
<span class="line-numbers"> 7</span>    from(zipTree(downloadGradleDist.outputs.files.singleFile))
<span class="line-numbers"> 8</span>    into(<span class="string"><span class="delimiter">&quot;</span><span class="content">gradle-</span><span class="inline"><span class="inline-delimiter">$</span>wrapper</span><span class="content">.gradleVersion</span><span class="delimiter">&quot;</span></span>) {
<span class="line-numbers"> 9</span>        from(<span class="string"><span class="delimiter">&quot;</span><span class="content">init.d</span><span class="delimiter">&quot;</span></span>) { into <span class="string"><span class="delimiter">&quot;</span><span class="content">init.d</span><span class="delimiter">&quot;</span></span> }
<span class="line-numbers">10</span>    }
<span class="line-numbers">11</span>}</code></pre></div></div></section><section id="build-pipeline-for-custom-gradle-distro"><h2>Build Pipeline for Custom Gradle Distro</h2><div class="listingblock"><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span>pipelineConfig {
<span class="line-numbers"> 2</span>    projectName = <span class="string"><span class="delimiter">'</span><span class="content">GradleRepackage</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 3</span>    createPipeline {
<span class="line-numbers"> 4</span>        initJob()
<span class="line-numbers"> 5</span>        buildAndUnitTestJob([<span class="key">gradleTasks</span>: <span class="string"><span class="delimiter">'</span><span class="content">build</span><span class="delimiter">'</span></span>, <span class="key">skipTests</span>: <span class="predefined-constant">true</span>])
<span class="line-numbers"> 6</span>        publishSnapshotJob([<span class="key">deployRepository</span>: <span class="string"><span class="delimiter">'</span><span class="content">tools-snapshot-local</span><span class="delimiter">'</span></span>])
<span class="line-numbers"> 7</span>        promoteToReleaseCandidateJob([gradleTasks1    : <span class="string"><span class="delimiter">'</span><span class="content">unSnapshot</span><span class="delimiter">'</span></span>,
<span class="line-numbers"> 8</span>                                      gradleTasks2    : <span class="string"><span class="delimiter">'</span><span class="content">assemble artifactoryPublish promoteReleaseCandidate createReleaseCandidateReport</span><span class="delimiter">'</span></span>,
<span class="line-numbers"> 9</span>                                      <span class="key">deployRepository</span>: <span class="string"><span class="delimiter">'</span><span class="content">tools-release-candidate-local</span><span class="delimiter">'</span></span>,
<span class="line-numbers">10</span>                                      <span class="key">skipTests</span>: <span class="predefined-constant">true</span>])
<span class="line-numbers">11</span>        promoteToReleaseJob([<span class="key">deployRepository</span>: <span class="string"><span class="delimiter">'</span><span class="content">tools-release-local</span><span class="delimiter">'</span></span>])</code></pre></div></div></section></section>
<section><section id="walk-thru-of-build-pipeline-dsl"><h2>Walk-thru of Build Pipeline DSL</h2><div class="ulist"><ul><li><p>Custom Gradle Distro includes JenkinsConventions plugin</p></li><li><p>JenkinsConventions extends Gradle Project DSL with "pipelineConfig"</p></li><li><p>Extension provides createPipeline(pipelineName, closure)</p><div class="ulist"><ul><li><p>adds new JvmPipeline to list of pipelines managed by extension</p></li></ul></div></li><li><p>updateJenkinsItems dependsOn jenkinsSanityCheck</p><div class="ulist"><ul><li><p>jenkinsSanityCheck dependsOn jenkinsRealizeDsl</p></li><li><p>jenkinsRealizeDsl calls project.pipelineConfig.pipelines*.createPipeline()</p></li></ul></div></li></ul></div></section><section id="jenkins-conventions-plugin"><h2>Jenkins Conventions Plugin</h2><div class="listingblock"><div class="title">build.gradle</div><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span>apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">'</span><span class="content">com.mutualofomaha.jenkins-conventions</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 2</span>
<span class="line-numbers"> 3</span>pipelineConfig {
<span class="line-numbers"> 4</span>    asi = <span class="string"><span class="delimiter">'</span><span class="content">PSS</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 5</span>    projectName = <span class="string"><span class="delimiter">'</span><span class="content">PremiumSaverSystem</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 6</span>    buildPipelineRows = <span class="integer">10</span>
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span>    createPipeline {
<span class="line-numbers"> 9</span>        initJob()
<span class="line-numbers">10</span>        buildAndUnitTestJob()
<span class="line-numbers">11</span>        staticCodeAnalysisJob()
<span class="line-numbers">12</span>        publishSnapshotJob()
<span class="line-numbers">13</span>        promoteToReleaseCandidateJob()
<span class="line-numbers">14</span>        promoteToReleaseJob()
<span class="line-numbers">15</span>    }
<span class="line-numbers">16</span>}</code></pre></div></div></section><section><div class="listingblock"><div class="title">JenkinsConventions.groovy</div><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span><span class="type">class</span> <span class="class">JenkinsConventions</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
<span class="line-numbers"> 2</span>    <span class="directive">protected</span> <span class="predefined-type">String</span> pluginId() { <span class="string"><span class="delimiter">&quot;</span><span class="content">com.mutualofomaha.jenkins-conventions</span><span class="delimiter">&quot;</span></span> }
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
<span class="line-numbers"> 5</span>        project.with {
<span class="line-numbers"> 6</span>            plugins.apply(<span class="string"><span class="delimiter">'</span><span class="content">com.terrafolio.jenkins</span><span class="delimiter">'</span></span>) <span class="comment">// Apply the Gradle Jenkins Plugin</span>
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span>            extensions.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">pipelineConfig</span><span class="delimiter">&quot;</span></span>, PipelineConfigurationExtension, project)
<span class="line-numbers"> 9</span>            tasks.create(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jenkinsRealizeDsl</span><span class="delimiter">&quot;</span></span>, <span class="key">type</span>: JenkinsRealizeDslTask, <span class="key">group</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Jenkins Management</span><span class="delimiter">&quot;</span></span>)
<span class="line-numbers">10</span>
<span class="line-numbers">11</span>            tasks.create(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">jenkinsSanityCheck</span><span class="delimiter">&quot;</span></span>, <span class="key">type</span>: JenkinsSanityCheckTask, <span class="key">group</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Jenkins Management</span><span class="delimiter">&quot;</span></span>) {
<span class="line-numbers">12</span>                dependsOn tasks.jenkinsRealizeDsl
<span class="line-numbers">13</span>            }
<span class="line-numbers">14</span>            tasks.updateJenkinsItems.dependsOn tasks.jenkinsSanityCheck
<span class="line-numbers">15</span>        }
<span class="line-numbers">16</span>    }
<span class="line-numbers">17</span>}</code></pre></div></div></section><section id="creating-the-build-pipeline"><h2>Creating the Build Pipeline</h2><div class="listingblock"><div class="title">PipelineConfiguration.groovy</div><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span><span class="type">void</span> createPipeline(<span class="predefined-type">String</span> pipelineName = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>, Closure closure) {
<span class="line-numbers"> 2</span>    <span class="comment">// Omitted: Checking for a few required fields...</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    <span class="comment">// Omitted: Set the name of the Build Pipeline folder...</span>
<span class="line-numbers"> 5</span>
<span class="line-numbers"> 6</span>    createFolder()
<span class="line-numbers"> 7</span>    createBuildPipelineView()
<span class="line-numbers"> 8</span>    closure()
<span class="line-numbers"> 9</span>}</code></pre></div></div></section><section id="creation-of-the-init-job"><h2>Creation of the Init Job</h2><div class="listingblock"><div class="title">PipelineConfiguration.groovy</div><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span><span class="type">void</span> initJob(<span class="predefined-type">Map</span> options = [:], Closure closure = {}) {
<span class="line-numbers"> 2</span>    loadOptions(options)
<span class="line-numbers"> 3</span>    options.put(<span class="string"><span class="delimiter">'</span><span class="content">step</span><span class="delimiter">'</span></span>, Step.INIT)
<span class="line-numbers"> 4</span>
<span class="line-numbers"> 5</span>    <span class="keyword">def</span> job = createBaseJenkinsJob(jenkins, Step.INIT.jobName, options)
<span class="line-numbers"> 6</span>    <span class="keyword">def</span> jobBuilder = <span class="keyword">new</span> InitJobBuilder(project, options)
<span class="line-numbers"> 7</span>    jobBuilder.build(job)
<span class="line-numbers"> 8</span>
<span class="line-numbers"> 9</span>    applyDsl job, closure
<span class="line-numbers">10</span>}</code></pre></div></div></section><section id="creation-of-the-build-job"><h2>Creation of the Build Job</h2><div class="listingblock"><div class="title">PipelineConfiguration.groovy</div><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span><span class="type">void</span> buildAndUnitTestJob(<span class="predefined-type">Map</span> options = [:], Closure closure = {}) {
<span class="line-numbers"> 2</span>    JenkinsJob previousJob = jobsList.last()
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    loadOptions(options)
<span class="line-numbers"> 5</span>    options.put(<span class="string"><span class="delimiter">'</span><span class="content">step</span><span class="delimiter">'</span></span>, Step.BUILD)
<span class="line-numbers"> 6</span>
<span class="line-numbers"> 7</span>    <span class="keyword">def</span> job = createBaseJenkinsJob(jenkins, Step.BUILD.jobName, options)
<span class="line-numbers"> 8</span>    <span class="keyword">def</span> jobBuilder = <span class="keyword">new</span> BuildJobBuilder(project, options)
<span class="line-numbers"> 9</span>    jobBuilder.build(job)
<span class="line-numbers">10</span>
<span class="line-numbers">11</span>    configureUpstreamJob(previousJob, job)
<span class="line-numbers">12</span>
<span class="line-numbers">13</span>    applyDsl job, closure
<span class="line-numbers">14</span>}</code></pre></div></div></section><section id="builders-for-each-job-type"><h2>Builders for each Job Type</h2></section><section id="base-job-builder"><h2>Base Job Builder</h2><div class="ulist"><ul><li><p>Sets up base configuration for all jobs</p><div class="ulist"><ul><li><p>JDK</p></li><li><p>Days to keep logs</p></li><li><p>Email notifications</p></li><li><p>JIRA Integration</p></li></ul></div></li></ul></div></section><section><div class="listingblock"><div class="title">BaseJobBuilder.groovy</div><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span><span class="type">class</span> <span class="class">BaseJobBuilder</span> <span class="directive">extends</span> AbstractJobBuilder {
<span class="line-numbers"> 2</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">int</span> DEFAULT_DAYSTOKEEPLOGS = <span class="integer">90</span>
<span class="line-numbers"> 3</span>
<span class="line-numbers"> 4</span>    PipelineStep step
<span class="line-numbers"> 5</span>    <span class="predefined-type">String</span> asi
<span class="line-numbers"> 6</span>    <span class="type">int</span> daysToKeepLogs = DEFAULT_DAYSTOKEEPLOGS
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span>    Closure jobDsl = {
<span class="line-numbers"> 9</span>        label(slaveLabel)
<span class="line-numbers">10</span>        description step?.jobDescription
<span class="line-numbers">11</span>        logRotator daysToKeepLogs
<span class="line-numbers">12</span>        jdk selectedJdk
<span class="line-numbers">13</span>        configure {
<span class="line-numbers">14</span>            <span class="local-variable">it</span> / <span class="string"><span class="delimiter">'</span><span class="content">properties</span><span class="delimiter">'</span></span> / <span class="string"><span class="delimiter">'</span><span class="content">hudson.plugins.jira.JiraProjectProperty</span><span class="delimiter">'</span></span> {
<span class="line-numbers">15</span>                siteName(<span class="string"><span class="delimiter">'</span><span class="content">https://jira.mutualofomaha.com/jiradc/</span><span class="delimiter">'</span></span>)
<span class="line-numbers">16</span>            }
<span class="line-numbers">17</span>        }
<span class="line-numbers">18</span>        publishers {
<span class="line-numbers">19</span>            extendedEmail(getNotificationList()) {
<span class="line-numbers">20</span>                <span class="keyword">def</span> sendToDevelopers = !<span class="predefined-type">System</span>.getenv(<span class="string"><span class="delimiter">'</span><span class="content">NOTIFICATION_OVERRIDE</span><span class="delimiter">'</span></span>)
<span class="line-numbers">21</span>
<span class="line-numbers">22</span>                trigger(<span class="key">triggerName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Unstable</span><span class="delimiter">'</span></span>, <span class="key">sendToDevelopers</span>: sendToDevelopers, <span class="key">sendToRequester</span>: <span class="predefined-constant">true</span>, <span class="key">sendToRecipientList</span>: <span class="predefined-constant">false</span>)
<span class="line-numbers">23</span>                trigger(<span class="key">triggerName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Success</span><span class="delimiter">'</span></span>, <span class="key">sendToDevelopers</span>: sendToDevelopers, <span class="key">sendToRequester</span>: <span class="predefined-constant">true</span>, <span class="key">sendToRecipientList</span>: <span class="predefined-constant">false</span>)
<span class="line-numbers">24</span>                trigger(<span class="key">triggerName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Failure</span><span class="delimiter">'</span></span>, <span class="key">sendToDevelopers</span>: sendToDevelopers, <span class="key">sendToRequester</span>: <span class="predefined-constant">true</span>, <span class="key">sendToRecipientList</span>: <span class="predefined-constant">true</span>)
<span class="line-numbers">25</span>                trigger(<span class="key">triggerName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Fixed</span><span class="delimiter">'</span></span>, <span class="key">sendToDevelopers</span>: sendToDevelopers, <span class="key">sendToRequester</span>: <span class="predefined-constant">true</span>, <span class="key">sendToRecipientList</span>: <span class="predefined-constant">true</span>)
<span class="line-numbers">26</span>                configure { node -&gt;
<span class="line-numbers">27</span>                    node / defaultContent &lt;&lt; <span class="string"><span class="delimiter">'</span><span class="content">\$DEFAULT_CONTENT\n\nChanges since last build:\n\n\${CHANGES, showPaths=true}</span><span class="delimiter">'</span></span>
<span class="line-numbers">28</span>                }
<span class="line-numbers">29</span>            }
<span class="line-numbers">30</span>        }
<span class="line-numbers">31</span>    }
<span class="line-numbers">32</span>}</code></pre></div></div></section><section><div class="listingblock"><div class="title">AbstractJobBuilder.groovy</div><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span><span class="directive">abstract</span> <span class="type">class</span> <span class="class">AbstractJobBuilder</span> {
<span class="line-numbers"> 2</span>    <span class="comment">/** Jenkins Job DSL to use to build this job. &lt;b&gt;Modify/override at your own risk!&lt;/b&gt;*/</span>
<span class="line-numbers"> 3</span>    <span class="directive">abstract</span> Closure jobDsl
<span class="line-numbers"> 4</span>
<span class="line-numbers"> 5</span>    <span class="comment">/** Handle to Gradle's (root) project */</span>
<span class="line-numbers"> 6</span>    Project project
<span class="line-numbers"> 7</span>
<span class="line-numbers"> 8</span>    <span class="directive">public</span> AbstractJobBuilder(Project project) {
<span class="line-numbers"> 9</span>        <span class="local-variable">this</span>.project = project
<span class="line-numbers">10</span>    }
<span class="line-numbers">11</span>
<span class="line-numbers">12</span>    JenkinsJob build(JenkinsJob job) {
<span class="line-numbers">13</span>        job.dsl { delegate.with jobDsl }
<span class="line-numbers">14</span>    }
<span class="line-numbers">15</span>}</code></pre></div></div></section><section id="init-job-builder"><h2>Init Job Builder</h2><div class="ulist"><ul><li><p>Configures SVN</p></li><li><p>Sets up polling (@yearly)</p></li><li><p>Executes the updateJenkinsItems Gradle task</p></li></ul></div></section><section><div class="listingblock"><div class="title">InitJobBuilder.groovy</div><div class="content"><pre class="CodeRay"><code class="groovy language-groovy"><span class="line-numbers"> 1</span><span class="type">class</span> <span class="class">InitJobBuilder</span> <span class="directive">extends</span> AbstractJobBuilder {
<span class="line-numbers"> 2</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> DEFAULT_GRADLETASKS = <span class="string"><span class="delimiter">'</span><span class="content">updateJenkinsItems</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 3</span>    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> DEFAULT_GRADLESWITCHES = <span class="string"><span class="delimiter">'</span><span class="content">--stacktrace</span><span class="delimiter">'</span></span>
<span class="line-numbers"> 4</span>
<span class="line-numbers"> 5</span>    <span class="predefined-type">String</span> svnUrl
<span class="line-numbers"> 6</span>    <span class="predefined-type">String</span> gitUrl
<span class="line-numbers"> 7</span>    <span class="predefined-type">String</span> gradleTasks = DEFAULT_GRADLETASKS
<span class="line-numbers"> 8</span>    <span class="predefined-type">String</span> gradleSwitches = DEFAULT_GRADLESWITCHES
<span class="line-numbers"> 9</span>
<span class="line-numbers">10</span>
<span class="line-numbers">11</span>    <span class="comment">/** Jenkins Job DSL to use to build this job. &lt;b&gt;Modify/override at your own risk!&lt;/b&gt;*/</span>
<span class="line-numbers">12</span>    Closure jobDsl = {
<span class="line-numbers">13</span>        wrappers { buildName(<span class="string"><span class="delimiter">'</span><span class="content">${ENV,var=&quot;BUILD_TIMESTAMP&quot;}</span><span class="delimiter">'</span></span>) }
<span class="line-numbers">14</span>        scm {
<span class="line-numbers">15</span>            <span class="keyword">if</span> (svnUrl) {
<span class="line-numbers">16</span>                svn {
<span class="line-numbers">17</span>                    location(svnUrl) {
<span class="line-numbers">18</span>                        <span class="comment">// The &quot;hudsonci&quot; ID used to authenticate against SVN must have the following GUID.</span>
<span class="line-numbers">19</span>                        credentials(<span class="string"><span class="delimiter">'</span><span class="content">aea63a94</span><span class="delimiter">'</span></span>)
<span class="line-numbers">20</span>                        checkoutStrategy(SvnCheckoutStrategy.UPDATE_WITH_CLEAN)
<span class="line-numbers">21</span>                    }
<span class="line-numbers">22</span>                    configure { scmNode -&gt;
<span class="line-numbers">23</span>                        scmNode / browser(<span class="type">class</span>: <span class="string"><span class="delimiter">'</span><span class="content">hudson.scm.browsers.FishEyeSVN</span><span class="delimiter">'</span></span>) {
<span class="line-numbers">24</span>                            url(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://fisheye.mutualofomaha.com/browse/</span><span class="inline"><span class="inline-delimiter">$</span>fisheyeRepo</span><span class="delimiter">&quot;</span></span>)
<span class="line-numbers">25</span>                            rootModule(<span class="string"><span class="delimiter">'</span><span class="delimiter">'</span></span>)
<span class="line-numbers">26</span>                        }
<span class="line-numbers">27</span>                    }
<span class="line-numbers">28</span>                }
<span class="line-numbers">29</span>            } <span class="keyword">else</span> <span class="keyword">if</span> (gitUrl) {
<span class="line-numbers">30</span>                git {
<span class="line-numbers">31</span>                    remote {
<span class="line-numbers">32</span>                        url(gitUrl)
<span class="line-numbers">33</span>                        credentials(<span class="string"><span class="delimiter">'</span><span class="content">bitbucket-ssh</span><span class="delimiter">'</span></span>)
<span class="line-numbers">34</span>                    }
<span class="line-numbers">35</span>                    browser {
<span class="line-numbers">36</span>                        stash(<span class="string"><span class="delimiter">'</span><span class="content">https://bitbucket.mutualofomaha.com/</span><span class="delimiter">'</span></span>)
<span class="line-numbers">37</span>                    }
<span class="line-numbers">38</span>                }
<span class="line-numbers">39</span>            }
<span class="line-numbers">40</span>        }
<span class="line-numbers">41</span>        configure {
<span class="line-numbers">42</span>            <span class="local-variable">it</span> / <span class="string"><span class="delimiter">'</span><span class="content">properties</span><span class="delimiter">'</span></span> / <span class="string"><span class="delimiter">'</span><span class="content">hudson.plugins.zentimestamp.ZenTimestampJobProperty</span><span class="delimiter">'</span></span> {
<span class="line-numbers">43</span>                changeBUILDID(<span class="string"><span class="delimiter">'</span><span class="content">true</span><span class="delimiter">'</span></span>)
<span class="line-numbers">44</span>                pattern(<span class="string"><span class="delimiter">'</span><span class="content">yyyyDDD.HHmmss</span><span class="delimiter">'</span></span>)
<span class="line-numbers">45</span>            }
<span class="line-numbers">46</span>        }
<span class="line-numbers">47</span>        triggers {
<span class="line-numbers">48</span>            <span class="keyword">if</span> (gitUrl) {
<span class="line-numbers">49</span>                bitbucketPush()
<span class="line-numbers">50</span>            }
<span class="line-numbers">51</span>            <span class="keyword">if</span> (pollScmSchedule) {
<span class="line-numbers">52</span>                scm(pollScmSchedule)
<span class="line-numbers">53</span>            } <span class="keyword">else</span> <span class="keyword">if</span> (cronSchedule) {
<span class="line-numbers">54</span>                cron(cronSchedule)
<span class="line-numbers">55</span>            } <span class="keyword">else</span> {
<span class="line-numbers">56</span>                scm(<span class="string"><span class="delimiter">'</span><span class="content">@yearly</span><span class="delimiter">'</span></span>)
<span class="line-numbers">57</span>            }
<span class="line-numbers">58</span>        }
<span class="line-numbers">59</span>
<span class="line-numbers">60</span>        steps {
<span class="line-numbers">61</span>            with gradleStep(gradleTasks, gradleSwitches, buildFileLocation)
<span class="line-numbers">62</span>        }
<span class="line-numbers">63</span>    }
<span class="line-numbers">64</span>}</code></pre></div></div></section><section id="build-job-builder"><h2>Build Job builder</h2><div class="ulist"><ul><li><p>Executes the test &amp; cloverGenerateReport Gradle tasks</p></li><li><p>Sets up JUnit Report Publishing</p></li><li><p>Updates JIRA</p></li><li><p>Sets up Clover Report Publishing</p></li></ul></div></section><section id="screen-shot-dsl-reference"><div class="imageblock" style=""><img src="./images/dsl-reference.png" alt="DSL Reference" width="1024" height="768"></div></section></section>
<section><section id="successes-and-challenges"><h2>Successes and Challenges</h2></section><section id="switching-tools-on-the-fly"><h2>Switching Tools on the Fly</h2><div class="paragraph"><p>JaCoCo &#8594; Atlassian Clover</p></div>
<div class="paragraph"><p>JDK 7 &#8594; JDK 8</p></div></section><section id="adoption"><h2>Adoption</h2><div class="ulist"><ul><li><p>Hundreds of Pipelines</p></li><li><p>WARs, Jars, EARs</p></li></ul></div></section></section>
<section id="questions"><h2>Questions</h2></section></div></div><script src="reveal.js/lib/js/head.min.js"></script><script src="reveal.js/js/reveal.js"></script><script>// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display controls in the bottom right corner
  controls: true,
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  previewLinks: false,
  // Theme (e.g., beige, black, league, night, serif, simple, sky, solarized, white)
  // NOTE setting the theme in the config no longer works in reveal.js 3.x
  //theme: Reveal.getQueryHash().theme || 'solarized',
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: Reveal.getQueryHash().transition || 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: '99%',
  height: 700,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      
      { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
  ]
});</script></body></html>